<!DOCTYPE html>
<html lang="ua" class="login-page">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Водоканал Бородянка. Система свердловин</title>
	<link rel="stylesheet" href="css/style.css">
	<link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
	<script src="js/jquery-3.2.1.min.js"></script>
</head>
<body>

	<div class="lf-wrap">
		<div>
			<form class="login-form" onsubmit="xlogin(this)">
				<label>Ваш логін</label>
				<input type="text" name="user" placeholder="Логін">
				<label>Ваш пароль</label>
				<input type="text" name="passwd" placeholder="Пароль">
				<button type="submit">Вхід</button>
				<div class="login-form-error-message">Дані вказано невірно!</div>
				<!--
				to show error message apply next code

				$('.login-form-error-message').stop().slideDown();
				setTimeout(function() {
					$('.login-form-error-message').stop().slideUp();
				}, 3000);

				-->
			</form>
		</div>
	</div>
	<script>
		const xws = new WebSocket('ws://dutch.lora-wan.net:8002/');
		function init(a) {xws.send(JSON.stringify({login:a.user.value,password:a.passwd.value,cmd:'auth_req'}));}
		xws.onopen = function() {console.log('init');};
		xws.onmessage = function(e) {
  			try{
				json = JSON.parse(e.data);
				console.log(e.data);
				if (!json.status) return;
				if (json.cmd=='auth_resp') {
					if (json.token) document.cookie='Token='+json.token;
					top.location="/";
				} 

    			}
     		catch(err) {console.log(err);}
		};


		function xlogin(f) {
		init(f);
//		alert(f.user.value);
		event.returnValue = false;
//		console.log("Test");
//		return false;
		}

	</script>
</body>
</html>
